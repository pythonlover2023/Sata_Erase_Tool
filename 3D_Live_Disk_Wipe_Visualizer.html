<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ðŸ”¥ IrsanAI 3D Live Disk Wipe Visualizer - Interactive Explorer</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Courier New', monospace; background: #000; color: #0f0; overflow: hidden; }
        #canvas-container { width: 100vw; height: 100vh; position: relative; }
        #render-canvas { width: 100%; height: 100%; display: block; }
        .hud { position: absolute; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: 10; }
        
        /* --- LEFT SIDE PANEL (Stats) --- */
        .stats-bar { position: absolute; top: 20px; left: 20px; width: 320px; background: rgba(0, 0, 0, 0.85); border: 2px solid #0f0; border-radius: 10px; padding: 20px; backdrop-filter: blur(10px); box-shadow: 0 0 30px rgba(0, 255, 0, 0.2); display: flex; flex-direction: column; gap: 15px; }
        .stat-item { display: flex; flex-direction: column; border-bottom: 1px solid rgba(0, 255, 0, 0.3); padding-bottom: 10px; }
        .stat-item:last-child { border-bottom: none; }
        .stat-label { font-size: 11px; color: #0f0; opacity: 0.8; margin-bottom: 4px; text-transform: uppercase; letter-spacing: 1px; display: flex; align-items: center; }
        .stat-icon { margin-right: 8px; font-size: 14px; }
        .stat-value { font-size: 20px; font-weight: bold; color: #0ff; text-shadow: 0 0 8px rgba(0, 255, 255, 0.6); padding-left: 22px; }
        .progress-container { margin-top: 10px; height: 25px; background: rgba(0, 255, 0, 0.1); border: 1px solid #0f0; border-radius: 12px; overflow: hidden; position: relative; }
        .progress-bar { height: 100%; background: linear-gradient(90deg, #0f0, #0ff); width: 0%; transition: width 0.2s linear; box-shadow: 0 0 15px rgba(0, 255, 0, 0.6); }
        .progress-text { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); font-weight: bold; font-size: 12px; text-shadow: 0 0 3px #000; color: #fff; }
        
        /* --- RIGHT SIDE ELEMENTS --- */
        .legend { position: absolute; top: 20px; right: 20px; width: 250px; background: rgba(0, 0, 0, 0.85); border: 2px solid #0f0; border-radius: 10px; padding: 15px; backdrop-filter: blur(10px); }
        .legend-title { font-size: 14px; margin-bottom: 10px; color: #0ff; border-bottom: 1px solid #0ff; padding-bottom: 5px; }
        .legend-item { display: flex; align-items: center; margin: 8px 0; font-size: 12px; }
        .legend-color { width: 15px; height: 15px; margin-right: 10px; border-radius: 3px; border: 1px solid #fff; }
        #pip-container { position: absolute; top: 200px; right: 20px; width: 250px; height: 150px; border: 2px solid #0ff; border-radius: 10px; overflow: hidden; background: #000; box-shadow: 0 0 20px rgba(0, 255, 255, 0.3); backdrop-filter: blur(5px); z-index: 20; }
        #pip-canvas { width: 100%; height: 100%; }
        #pip-label { position: absolute; top: 5px; left: 10px; color: #0ff; font-size: 10px; background: rgba(0,0,0,0.7); padding: 2px 5px; border-radius: 3px; }
        #io-graph-container { position: absolute; top: 370px; right: 20px; width: 250px; background: rgba(0,0,0,0.85); border: 1px solid #0f0; border-radius: 5px; padding: 10px; }
        #io-graph-label { font-size: 12px; text-align: center; margin-bottom: 5px; color: #0f0; }
        #io-graph { background: rgba(0, 20, 0, 0.3); width: 100%; height: 80px; display: block; }

        /* --- BOTTOM ELEMENTS --- */
        .sector-panel { position: absolute; bottom: 20px; left: 20px; background: rgba(0, 0, 0, 0.85); border: 2px solid #ff0; border-radius: 10px; padding: 15px; min-width: 320px; backdrop-filter: blur(10px); box-shadow: 0 0 30px rgba(255, 255, 0, 0.2); }
        .sector-title { color: #ff0; font-size: 14px; margin-bottom: 10px; text-transform: uppercase; letter-spacing: 2px; border-bottom: 1px solid #ff0; padding-bottom: 5px; }
        .sector-info { font-size: 12px; line-height: 1.6; }
        #hex-dump { position: absolute; bottom: 160px; left: 20px; width: 320px; height: 150px; font-size: 10px; line-height: 1.2; color: #0f0; opacity: 0.7; overflow: hidden; text-shadow: 0 0 5px #0f0; background: rgba(0,0,0,0.5); padding: 10px; border-left: 2px solid #0f0; }

        /* --- CONTROLS & HINTS (Updated) --- */
        .controls { position: absolute; bottom: 20px; right: 20px; pointer-events: all; text-align: right; }
        .control-btn { background: rgba(0, 255, 0, 0.2); border: 2px solid #0f0; color: #0f0; padding: 10px 20px; margin: 5px; border-radius: 5px; cursor: pointer; font-family: 'Courier New', monospace; font-size: 12px; transition: all 0.3s; backdrop-filter: blur(10px); }
        .control-btn:hover { background: rgba(0, 255, 0, 0.4); box-shadow: 0 0 20px rgba(0, 255, 0, 0.6); transform: scale(1.05); }
        .control-btn.active { background: rgba(0, 255, 0, 0.6); box-shadow: 0 0 30px rgba(0, 255, 0, 0.8); }
        .controls-hint { display: none; /* Initially hidden */ color: #ff0; font-size: 11px; margin-top: 10px; background: rgba(0,0,0,0.7); padding: 8px; border-radius: 5px; border: 1px solid #ff0; pointer-events: none; }
    </style>
</head>
<body>
    <div id="canvas-container">
        <canvas id="render-canvas"></canvas>
        <div class="hud">
            <!-- UI Panels (unchanged) -->
            <div class="stats-bar" id="stats-bar">...</div>
            <div class="legend">...</div>
            <div id="pip-container">...</div>
            <div id="io-graph-container">...</div>
            <div id="hex-dump"></div>
            <div class="sector-panel" id="sector-panel" style="display: none;">...</div>
            
            <!-- Controls & Hint -->
            <div class="controls">
                <button class="control-btn active" id="btn-autofocus">ðŸ“· AUTO FOCUS</button>
                <button class="control-btn" id="btn-freecam">ðŸŽ® FREE CAM</button>
                <button class="control-btn" id="btn-fullscreen">â›¶ FULLSCREEN</button>
                <div class="controls-hint" id="controls-hint">
                    <b>Free Cam Active</b><br>
                    L-Click: Rotate | R-Click: Pan<br>
                    Wheel: Zoom | Click Sector: Scan
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/controls/OrbitControls.js"></script>

    <script>
        // ===== 3D VISUALIZATION ENGINE - INTERACTIVE EXPLORER =====
        
        let scene, camera, renderer, disk, clock, controls;
        let pipRenderer, pipCamera;
        let autoFocus = true;
        let isSimulating = false;

        let totalSectors = 1, wipedSectors = 0, wipeSpeed = 0;
        let currentSectorIndex = 0;
        let sectorMeshes = [];
        let head, arm;

        const graphCanvas = document.getElementById('io-graph');
        const graphCtx = graphCanvas.getContext('2d');
        const speedHistory = new Array(60).fill(0);
        const hexDumpEl = document.getElementById('hex-dump');

        // Raycasting for "Data Ghost" scan
        const raycaster = new THREE.Raycaster();
        const mouse = new THREE.Vector2();
        let ghostMaterial;

        function init() {
            // Scene & Main Camera
            scene = new THREE.Scene();
            scene.background = new THREE.Color(0x000000);
            scene.fog = new THREE.FogExp2(0x000000, 0.03);
            camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
            camera.position.set(0, 5, 10);

            // Main Renderer
            renderer = new THREE.WebGLRenderer({ canvas: document.getElementById('render-canvas'), antialias: true });
            renderer.setSize(window.innerWidth, window.innerHeight);
            renderer.setPixelRatio(window.devicePixelRatio);

            // PiP Renderer & Camera
            const pipCanvas = document.getElementById('pip-canvas');
            pipRenderer = new THREE.WebGLRenderer({ canvas: pipCanvas, antialias: true });
            pipRenderer.setSize(pipCanvas.clientWidth, pipCanvas.clientHeight);
            pipCamera = new THREE.PerspectiveCamera(60, pipCanvas.clientWidth / pipCanvas.clientHeight, 0.1, 50);
            scene.add(pipCamera);

            // Lighting
            scene.add(new THREE.AmbientLight(0x404040, 0.8));
            const dirLight = new THREE.DirectionalLight(0x00ff88, 0.8);
            dirLight.position.set(5, 10, 7);
            scene.add(dirLight);

            // Create HDD Model
            createHDD();

            // NEW: OrbitControls for Free Cam
            controls = new THREE.OrbitControls(camera, renderer.domElement);
            controls.enableDamping = true;
            controls.dampingFactor = 0.1;
            controls.enabled = false; // Initially disabled

            // NEW: Ghost Material
            const noiseTexture = new THREE.CanvasTexture(generateNoiseCanvas());
            ghostMaterial = new THREE.MeshBasicMaterial({ map: noiseTexture, transparent: true, opacity: 0.8 });

            // Event Listeners & Clock
            clock = new THREE.Clock();
            window.addEventListener('resize', onWindowResize);
            document.getElementById('btn-autofocus').addEventListener('click', () => setCameraMode(true));
            document.getElementById('btn-freecam').addEventListener('click', () => setCameraMode(false));
            document.getElementById('btn-fullscreen').addEventListener('click', () => document.documentElement.requestFullscreen());
            window.addEventListener('click', onSectorClick);

            setCameraMode(true); // Initial mode
            animate();
        }
        
        function createHDD() {
            // ... (createHDD code is unchanged)
        }
        
        function animate() {
            requestAnimationFrame(animate);
            const delta = clock.getDelta();

            // Animate disk based on live speed
            const rotationSpeed = isSimulating ? THREE.MathUtils.lerp(0.5, 5, Math.min(wipeSpeed / 150, 1)) : 0;
            if(disk) disk.rotation.y += delta * rotationSpeed;

            // Animate head position
            if (isSimulating && arm) {
                const progress = totalSectors > 0 ? wipedSectors / totalSectors : 0;
                const armAngle = (progress * 15) % 1 > 0.5 ? 0.4 : -0.4;
                arm.parent.rotation.y = THREE.MathUtils.lerp(arm.parent.rotation.y, armAngle, delta * 2);
                const armRadius = 1.2 + (progress * 1.3) % 1.3;
                arm.position.x = armRadius;
                head.position.x = armRadius * 2;
            }

            // Camera Logic
            if (autoFocus && isSimulating) {
                const focusPoint = head.getWorldPosition(new THREE.Vector3());
                camera.position.lerp(new THREE.Vector3(focusPoint.x + 2, focusPoint.y + 2, focusPoint.z + 2), delta * 1);
                camera.lookAt(focusPoint);
            } else {
                controls.update(); // Update OrbitControls if not in auto-focus
            }

            // Update immersion elements
            if (isSimulating) {
                updateHexDump();
                drawGraph();
            }
            
            renderer.render(scene, camera);
            pipRenderer.render(scene, pipCamera);
        }

        // --- NEW & UPDATED FUNCTIONS ---

        function setCameraMode(isAuto) {
            autoFocus = isAuto;
            controls.enabled = !isAuto;
            document.getElementById('btn-autofocus').classList.toggle('active', isAuto);
            document.getElementById('btn-freecam').classList.toggle('active', !isAuto);
            document.getElementById('controls-hint').style.display = isAuto ? 'none' : 'block';
        }

        function onSectorClick(event) {
            if (autoFocus || !isSimulating) return; // Only in Free Cam during wipe

            // Calculate mouse position in normalized device coordinates
            mouse.x = (event.clientX / window.innerWidth) * 2 - 1;
            mouse.y = - (event.clientY / window.innerHeight) * 2 + 1;

            raycaster.setFromCamera(mouse, camera);
            const intersects = raycaster.intersectObjects(sectorMeshes);

            if (intersects.length > 0) {
                const sector = intersects[0].object;

                // "Data Ghost" effect
                const originalMaterial = sector.material;
                sector.material = ghostMaterial;

                setTimeout(() => {
                    sector.material = originalMaterial; // Restore original material
                }, 400); // Effect duration
            }
        }

        function generateNoiseCanvas() {
            const canvas = document.createElement('canvas');
            canvas.width = 64;
            canvas.height = 64;
            const ctx = canvas.getContext('2d');
            const imageData = ctx.createImageData(64, 64);
            for (let i = 0; i < imageData.data.length; i += 4) {
                const val = Math.random() * 255;
                imageData.data[i] = 0;       // R
                imageData.data[i + 1] = val; // G
                imageData.data[i + 2] = 0;   // B
                imageData.data[i + 3] = 255; // A
            }
            ctx.putImageData(imageData, 0, 0);
            return canvas;
        }

        function updateVisualsFromLiveData() { /* Unchanged */ }
        function updateHexDump() { /* Unchanged */ }
        function drawGraph() { /* Unchanged */ }
        function fetchLiveData() { /* Unchanged */ }
        function onWindowResize() { /* Unchanged */ }

        window.addEventListener('load', init);
    </script>
</body>
</html>
